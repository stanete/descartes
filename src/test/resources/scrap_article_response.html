<!DOCTYPE html>
<html lang="es">
<head>
<meta
name="google-site-verification"
content="qx-BxwOavZ_tGa0kBQP-nYntc2SXD0YIhVaTumK6N1s"
/>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta
name="description"
content="Basic System Design concepts every Software Engineer should understand."
/>


<title>System Design 101</title>


<!-- Social sharing metas -->
<!-- Twitter Card -->
<meta
name="twitter:card"
content="summary_large_image"
/>
<meta name="twitter:site" content="@stanete" />
<meta name="twitter:creator" content="@stanete" />
<meta
name="twitter:title"
content="System Design 101"
/>
<meta
name="twitter:description"
content="Basic System Design concepts every Software Engineer should understand."
/>

<meta
name="twitter:image:src"
content="https://stanete.com/images/system_design_cover.png"
/>

<!-- End Twitter Card -->
<!-- Facebook Open Graph -->
<meta
property="og:url"
content="https://stanete.com/system-design-101"
/>
<meta
property="og:title"
content="System Design 101"
/>
<meta
property="og:description"
content="Basic System Design concepts every Software Engineer should understand."
/>
<meta
property="og:type"
content="article"
/>


<meta property="og:site_name" content="With a grain of salt" />

<meta
property="og:image"
content="https://stanete.com/images/system_design_cover.png"
/>

<!-- End Facebook Open Graph -->


<!-- Google verify -->

<meta name="google-site-verification" content="MZlkm_Gq7ly7eJkGo-x7JDMux-ljTyc7sFduOaUZBVg" />


<link rel="icon" href="/assets/favicon.png" />
<link rel="apple-touch-icon" href="/assets/touch-icon.png" />
<link href="https://fonts.googleapis.com/css?family=Karla" rel="stylesheet" />
<link rel="stylesheet" href="/assets/core.css" />
<link rel="canonical" href="/system-design-101" />
<link
rel="alternate"
type="application/atom+xml"
title="With a grain of salt"
href="/feed.xml"
/>



<script data-host="https://microanalytics.io" data-dnt="false" src="https://microanalytics.io/js/script.js" id="ZwSg9rf6GA" async defer></script>

<script>
(function(i, s, o, g, r, a, m) {
    i["GoogleAnalyticsObject"] = r;
    (i[r] =
        i[r] ||
            function() {
                (i[r].q = i[r].q || []).push(arguments);
            }),
    (i[r].l = 1 * new Date());
    (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
    a.async = 1;
    a.src = g;
    m.parentNode.insertBefore(a, m);
})(
window,
document,
"script",
"//www.google-analytics.com/analytics.js",
"ga"
);

ga("create", "UA-54798604-2", "auto");
ga("send", "pageview");
</script>

<link type="application/atom+xml" rel="alternate" href="https://stanete.com/feed.xml" title="With a grain of salt" />

</head>

<body>
<aside class="logo">


<a href="/">
<img src="https://www.gravatar.com/avatar/43c674a8e565e1f9d4b34bdfe7cc6088.png?s=80" class="gravatar" />
</a>
<span class="logo-prompt">Read more posts</span>
</aside>


<main>
<article>
<div class="center">
<h1>System Design 101</h1>
<time>January 9, 2021</time>
</div>

<div class="divider"></div>

<p>You can read this post in Spanish <a href="/es/system-design-101">here</a>.</p>

<p>All my interviews are wrapped <a href="storytelling-tips-technical-interviews">in a little story</a>. And in almost all of them I end up doing a simple question:</p>

<blockquote>
<p>Why is it so important to design our services so they have no state? Specially if they are running somewhere on a server.</p>
</blockquote>

<p><img src="/images/system_design_question.png" alt="" /></p>

<p>It is surprising how many people get it wrong. And when they get it wrong, I do a follow up question:</p>

<blockquote>
<p>What is a Load Balancer?</p>
</blockquote>

<p>To which almost everybody answers that DevOps/SRE is not their field. This is wrong!</p>

<p>Every Software Engineer (I don‚Äôt care if you call yourself developer, programmer or unicorn) should understand at least the basics of <em>System Design</em>, no matter their seniority or if their specialty is frontend, backend, mobile, productivity tools or <a href="https://www.minimum.run/">no code</a>.</p>

<ol>
<li>
<p>Mostly because it is essential to have a holistic and systemic understanding of how different services and applications interact.</p>
</li>
<li>
<p>Because the way your infrastructure is set up affects your code. Obviously.</p>
</li>
<li>
<p>And also because it is not that difficult. You don‚Äôt have to know how to set up a <em>Load Balancer</em> but it is important to understand what it is, why you need one and when to use it.</p>
</li>
</ol>

<p>This is the first post of a series (probably three) that cover the basics of <em>System Design</em>. I will not enter in details because it would require to write a whole book about each topic. However, I will provide many resources for you to further read and investigate.</p>

<p><a href="https://twitter.com/intent/tweet?text=System Design 101&amp;url=https://stanete.com/system-design-101&amp;via=stanete&amp;related=stanete">Share this post on üê¶ twitter</a> or subscribe to my newsletter <strong>With a grain of salt</strong> and receive an email with updates from time to time.</p>

<!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css" />

<style type="text/css">
#mc_embed_signup {
    background: #fff;
    clear: left;
    font: 14px Helvetica, Arial, sans-serif;
    width: 100%;
}
#mc_embed_signup input.button {
    background: #6c63ff;
}
#mc_embed_signup input.button:hover {
    background: #5b52d0;
}
/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>

<div id="mc_embed_signup">
<form action="//stanete.us14.list-manage.com/subscribe/post?u=62d5732518b4f9dfee2100fd8&amp;id=a8df3fa8c9" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
<div id="mc_embed_signup_scroll">
<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Email" required="" />
<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
<div style="position: absolute; left: -5000px;" aria-hidden="true">
<input type="text" name="b_62d5732518b4f9dfee2100fd8_a8df3fa8c9" tabindex="-1" value="" />
</div>
<div class="clear">
<input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button" />
</div>
</div>
</form>
</div>

<!--End mc_embed_signup-->

<h2 id="a-client-a-server-and-a-database-walk-into-a-coffee-shop">A client, a server and a database walk into a coffee shop</h2>

<p>The most typical setup that you will find out there is a frontend application (let‚Äôs say it uses <a href="https://reactjs.org/">React</a>) that talks to a backend service (let‚Äôs say it‚Äôs a <a href="https://spring.io/">Spring</a> application written in <a href="https://kotlinlang.org/">Kotlin</a> that serves a <a href="https://restfulapi.net/">REST API</a> and runs in a <a href="https://www.docker.com/">Docker</a> container) which in turn is connected to a database (let‚Äôs say <a href="https://www.postgresql.org/">PostgreSQL</a>).</p>

<p><img src="/images/system_design_basic.png" alt="" /></p>

<p>But this representation of the system is incomplete at most. If not totally unacurrate. Thruth being told, there is not just one instance of the frontend application. That would be terrible. Instead, each client runs one on their own device. Desktop or mobile. Each one with their own connectivity conditions using different browsers. And obviously, you can‚Äôt ignore <a href="https://www.cloudflare.com/learning/dns/what-is-dns/">DNS</a>.</p>

<p><img src="/images/system_design_dns.png" alt="" /></p>

<p>This is more accurate but it‚Äôs still far from reality. At least on the frontend side. So let‚Äôs talk about <a href="https://medium.com/@maneesha.wijesinghe1/what-happens-when-you-type-an-url-in-the-browser-and-press-enter-bb0aa2449c1a">what happens when you type a url into a browser and press Enter</a>.</p>

<h2 id="so-you-press-enter">So you press Enter</h2>

<p>Nowadays people just connect their <a href="https://github.com/stanete">GitHub</a> repository to <a href="https://www.netlify.com/">Netlify</a> or a similar service and they‚Äôre happy. But let‚Äôs take a step back and acknowledge that all HTML, CSS, JS files and the other static assets of a web page need to be stored somewhere on the dark corners of the Internet. Netlify takes care of this and much more but not so long ago people needed to build their React application themselves and upload the content to a service like <a href="https://aws.amazon.com/s3/">AWS S3</a>.</p>

<p>But storing that content is not everything. It needs to be served somehow to the users and it turns out <a href="https://www.cloudflare.com/learning/cdn/what-is-a-cdn/">CDNs</a> are very good at that.</p>

<p>So here is how it goes step by step:</p>

<ol>
<li>
<p>The browser asks the DNS for the corresponding IP address of the url. That IP address corresponds to the CDN (maybe AWS Cloudfront).</p>
</li>
<li>
<p>The browser asks for the content to the CDN. If the CDN doesn‚Äôt have the content in the cache, the CDN requests it from the storage (maybe AWS S3).</p>
</li>
<li>
<p>The storage returns the content to the CDN server. It sometimes includes an HTTP header called Time-to-Live (TTL) which describes <a href="https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/Expiration.html">how long the content is cached</a>.</p>
</li>
<li>
<p>The CDN catches the content and returns it to the browser. The content remains cached in the CDN until the TTL expires.</p>
</li>
<li>
<p>When another browser asks for the content, the CDN returns it directly until the TTL expires.</p>
</li>
</ol>

<p><img src="/images/system_design_cdn.png" alt="" /></p>

<p>Today you could probably skip all this but you will still find a lot of applications out there that use this setup (probably most of them). So <a href="https://paulstamatiou.com/hosting-on-amazon-s3-with-cloudfront/">here is a post explaining how to host on AWS S3 with CloudFront as a CDN</a> and <a href="https://paulstamatiou.com/moving-from-amazon-s3-to-netlify/">here is another one explaining how to migrate the whole thing to Netlify</a>. Your welcome.</p>

<p>Unless the web page has like a huge lot of traffic you won‚Äôt have to worry about scalability issues for some time. But what happens with the backend?</p>

<h2 id="put-a-load-balancer-in-your-life">Put a Load Balancer in your life</h2>

<p>You can‚Äôt controll where the different instances of the frontend application will run. But with backend services is different. Not only can you control how many instances of the service are running at any time. But you can also control the configuration of the server (like RAM or CPU) in which each instance is running.</p>

<p>You can scale the service vertically or scale it up. Mostly when traffic is low. Just add more memory and/or CPU to the server. However, this is naturally limited, and it increases costs very quickly. Memory and CPU are naturally expensive resources.</p>

<p>Horizontal scaling or scale out is more desirable for large scale services. It just means you can spin up as many instances as you want. But this solution comes with a couple of problems. Don‚Äôt worry, they can be solved. How can you have a single entry point so the design is not leaked to the outside world? How can you balance the traffic load between all the instances? You‚Äôre right. Using a <a href="https://www.nginx.com/resources/glossary/load-balancing/">Load Balancer</a>.</p>

<p><img src="/images/system_design_load_balancer.png" alt="" /></p>

<p>With this setup, the backend services are unreachable directly by clients anymore. They connect to the public IP of the Load Balancer which evenly distributes incomming traffic and communicates internally through private IPs.</p>

<p>Horizontal scaling comes with additional benefits. If one instance goes offline, traffic will be routed to the remaining instances. If traffic grows rapidly you can automatically spin up as many instances as needed and shut them down afterwards to control costs.</p>

<p>And here it is the initial question.</p>

<blockquote>
<p>Why is it so important to design our services so they have no state? Specially if they are running somewhere on a server.</p>
</blockquote>

<p>Assuming horizontal scaling, there is no guarantee a client will hit the same instance of the service twice in row. It‚Äôs true that depending on the algorithm of the Load Balancer you can have some consistency. But what happens if an instance crashes completely? State would be lost forever. That‚Äôs why state is stored in a database, which may at some point become a problem because there is only one instance of it. And it‚Äôll probably be your next bottleneck.</p>

<h2 id="one-of-the-two-hard-things"><a href="https://www.karlton.org/2017/12/naming-things-hard/">One of the two hard things</a></h2>

<blockquote>
<p>There are only two hard things in Computer Science: cache invalidation and naming things. ‚Äì Phil Karlton</p>
</blockquote>

<p>You can remove some load from the database by using a <a href="https://aws.amazon.com/caching/">cache</a>, which is a temporary data store layer, such as <a href="https://redis.io/topics/introduction">Redis</a> or <a href="https://memcached.org/">Memcached</a>. It usually stores the result of expensive responses or frequently accessed data. It is much faster than the database because it stores the data in memory. You must be careful though: if a cache server restarts, all the data is lost.</p>

<p>How it works?</p>

<ol>
<li>
<p>After receiving a request, the backend server first checks if the cache has the available response.</p>
</li>
<li>
<p>If it hasn‚Äôt, it queries the database, stores the response in cache, and sends it back to the client.</p>
</li>
<li>
<p>Next time a client asks for the same data, it is returned directly from the cache without quering the database.</p>
</li>
</ol>

<p><img src="/images/system_design_cache.png" alt="" /></p>

<p>You better use cache when data is read frequently but modified infrequently. And don‚Äôt forget to implement an expiration policy. Once the data is expired, it is removed from teh cache. The expiration policy helps to keep the cache data in sync with the database but it does not solve the consistency problem. Invalidating cache when needed is challenging and is not a topic I‚Äôm willing to write about now.</p>

<h2 id="the-clone-wars">The clone wars</h2>

<p>Cache is good and all that but at some point it won‚Äôt be enough. The database is still a single instance. A <a href="https://en.wikipedia.org/wiki/Single_point_of_failure">single point of failure</a> and a bottleneck.</p>

<p>Read operations are usually more frequent than write operations. So you can use <a href="https://en.wikipedia.org/wiki/Replication_(computing)">replication</a> which is a technique for managing multiple instances of a database, usually with a principal/seconday relationship between the original and the copies. The principal database generally supports only write operations while the copies only support read operations.</p>

<p><img src="/images/system_design_db_replication.png" alt="" /></p>

<p>Replication has multiple advantages like better performance, reliability and high availability. The read operations are distributed across the secondary databases, data is never lost because it is replicated across multiple locations and even if one secondary database goes offline you can still access data from other locations.</p>

<p>If all the secondary databases go offline, read operations will be directed to the principal database teporarily. Whenever a secondary database is up and running, read operations will again be redirected to them.</p>

<p>If the principal database goes offline, a secondary database will be promoted to be the new principal database. A new instance will replace the old secondary database. This is more difficult than it sounds because in real life data may or may not be syncronized.</p>

<p>If all the database instances, principal and secondary, go offline, you have a huge problem.</p>

<p>Replication is just one of many techniques for scaling the database horizontally. <a href="https://www.digitalocean.com/community/tutorials/understanding-database-sharding">Sharding</a> is another one but I will talk about it in another post.</p>

<h2 id="the-magic-always-happens-asynchronous">The magic always happens asynchronous</h2>

<p>Some of the tasks your services execute, like sending a notification or processing a photo, don‚Äôt need to happen right away. They can be executed asynchronosuly. However, the instructions for knowing what task to execute need to be stored somewhere until a service is ready for executing it. For that you can use a <a href="https://redislabs.com/ebook/part-2-core-concepts/chapter-6-application-components-in-redis/6-4-task-queues/">task Queue</a> also called a <a href="https://aws.amazon.com/message-queue/">message Queue</a>. In reality there are <a href="https://stackoverflow.com/questions/10075817/message-queue-vs-task-queue-difference">differences between a task Queue and a message Queue</a> but I‚Äôm going to ignore them for now. You may have heard of <a href="https://www.rabbitmq.com/">RabittMQ</a>, <a href="https://aws.amazon.com/es/sqs/">AWS SQS</a> or <a href="https://docs.celeryproject.org/en/stable/">Celery</a>.</p>

<p><img src="/images/system_design_queue_workers.png" alt="" /></p>

<p>The basic architecture of a Queue is simple. Some services, called producers or publishers, create messages and publish them to the Queue. Other services, called consumers or subscribers, connect to the Queue and consume the messages one by one to perform the needed tasks.</p>

<blockquote>
<p>There are only two hard problems in distributed systems:  2. Exactly-once delivery 1. Guaranteed order of messages 2. Exactly-once delivery.</p>
</blockquote>

<p>Using e message Queue comes with its own problems. It is difficult to ensure that a message will be consumed <a href="https://bravenewgeek.com/you-cannot-have-exactly-once-delivery/">exactly once</a>. It is equally difficult to ensure all the messages will be consumed in the desired order.</p>

<h2 id="a-new-beginning">A new beginning</h2>

<p>Here is a more complete and hollistic view of the system and how the different services interact. In terms of scalabiliy, your product needs to be very successful so you need more than this. But I haven‚Äôt discussed yet authentication, security or rate limiters.</p>

<p><img src="/images/system_design_complete.png" alt="" /></p>

<p>In the diagram you can see a bunch of monoliths: one for the frontend and other for the backend. Read <a href="/system-design-102">the second post</a> in which I talk about the implications of having multiple services talking to each other when breaking the monoliths, backends for frontend, microfrontends or server side rendering. In next posts I will cover other topics such as multiple data centers, virtual private networks or sharding.</p>

<p><a href="https://twitter.com/intent/tweet?text=System Design 101&amp;url=https://stanete.com/system-design-101&amp;via=stanete&amp;related=stanete">Share this post on üê¶ twitter</a> or subscribe to my newsletter <strong>With a grain of salt</strong> and receive an email with updates from time to time.</p>

<!-- Begin MailChimp Signup Form -->
<link
href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css"
rel="stylesheet"
type="text/css"
/>
<style type="text/css">
#mc_embed_signup {
    background: #fff;
    clear: left;
    font: 14px Helvetica, Arial, sans-serif;
    width: 100%;
}
#mc_embed_signup input.button {
    background: #6c63ff;
}
#mc_embed_signup input.button:hover {
    background: #5b52d0;
}
/* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
     We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form
action="//stanete.us14.list-manage.com/subscribe/post?u=62d5732518b4f9dfee2100fd8&amp;id=a8df3fa8c9"
method="post"
id="mc-embedded-subscribe-form"
name="mc-embedded-subscribe-form"
class="validate"
target="_blank"
novalidate
>
<div id="mc_embed_signup_scroll">
<input
type="email"
value=""
name="EMAIL"
class="email"
id="mce-EMAIL"
placeholder="Email"
required
/>
<!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
<div style="position: absolute; left: -5000px;" aria-hidden="true">
<input
type="text"
name="b_62d5732518b4f9dfee2100fd8_a8df3fa8c9"
tabindex="-1"
value=""
/>
</div>
<div class="clear">
<input
type="submit"
value="Subscribe"
name="subscribe"
id="mc-embedded-subscribe"
class="button"
/>
</div>
</div>
</form>
</div>

<!--End mc_embed_signup-->


</article>

<div class="page-navigation">

<a class="next" href="/system-design-102" title="NEXT: System Design 102"
>&lt;&lt;</a
>
<span> &middot; </span>

<a class="home" href="/" title="Read more posts"
>Read more posts</a
>

<span> &middot; </span>
<a
class="prev"
href="/compound-returns-engineering-excellence"
title="PREV: Compound Returns on Engineering Excellence"
>&gt;&gt;</a
>

</div>

</main>

<div class="footer">
<span class="block"
>Made with &hearts; using <a href="https://jekyllrb.com/">Jekyll</a> &amp;
<a
href="https://github.com/heiswayi/the-plain"
title="The Plain theme by Heiswayi Nrird"
>The Plain</a
>
&middot; &lt;/&gt; on
<a
href="https://github.com/stanete"
title="Hosted on GitHub"
>GitHub</a
></span
>
<span class="block"
>&copy; 2021 David Stanete</span
>
</div>

</body>
</html>
